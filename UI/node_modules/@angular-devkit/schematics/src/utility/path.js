"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
const exception_1 = require("../exception/exception");
class InvalidPathException extends exception_1.BaseException {
    constructor(path) { super(`Path "${path}" is invalid.`); }
}
exports.InvalidPathException = InvalidPathException;
function normalizePath(path) {
    let p = path;
    if (p[0] != '/') {
        p = '/' + p;
    }
    if (p.endsWith('..')) {
        throw new InvalidPathException(path);
    }
    let oldP = null;
    while (oldP !== p) {
        oldP = p;
        p = p
            .replace(/\/[^\/]+\/\.\.\//g, '/')
            .replace(/\/[^\/]+\/\.\.$/g, '/')
            .replace(/\/\.?$/g, '/')
            .replace(/\/\.?\//g, '/');
    }
    if (p.startsWith('/../') || (p.endsWith('/') && p !== '/')) {
        throw new InvalidPathException(path);
    }
    return p;
}
exports.normalizePath = normalizePath;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF0aC5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvaGFuc2wvU291cmNlcy9kZXZraXQvIiwic291cmNlcyI6WyJwYWNrYWdlcy9hbmd1bGFyX2RldmtpdC9zY2hlbWF0aWNzL3NyYy91dGlsaXR5L3BhdGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7O0dBTUc7QUFDSCxzREFBdUQ7QUFRdkQsMEJBQWtDLFNBQVEseUJBQWE7SUFDckQsWUFBWSxJQUFZLElBQUksS0FBSyxDQUFDLFNBQVMsSUFBSSxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7Q0FDbkU7QUFGRCxvREFFQztBQUdELHVCQUE4QixJQUFZO0lBQ3hDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQztJQUNiLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2hCLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQ2QsQ0FBQztJQUNELEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3JCLE1BQU0sSUFBSSxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQsSUFBSSxJQUFJLEdBQWtCLElBQUksQ0FBQztJQUMvQixPQUFPLElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUNsQixJQUFJLEdBQUcsQ0FBQyxDQUFDO1FBQ1QsQ0FBQyxHQUFHLENBQUM7YUFDRixPQUFPLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxDQUFDO2FBQ2pDLE9BQU8sQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLENBQUM7YUFDaEMsT0FBTyxDQUFDLFNBQVMsRUFBRSxHQUFHLENBQUM7YUFDdkIsT0FBTyxDQUFDLFVBQVUsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRUQsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzRCxNQUFNLElBQUksb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVELE1BQU0sQ0FBRSxDQUFtQixDQUFDO0FBQzlCLENBQUM7QUF4QkQsc0NBd0JDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEdvb2dsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9hbmd1bGFyLmlvL2xpY2Vuc2VcbiAqL1xuaW1wb3J0IHsgQmFzZUV4Y2VwdGlvbiB9IGZyb20gJy4uL2V4Y2VwdGlvbi9leGNlcHRpb24nO1xuXG5cbmV4cG9ydCB0eXBlIFNjaGVtYXRpY1BhdGggPSBzdHJpbmcgJiB7XG4gIF9fUFJJVkFURV9TQ0hFTUFUSUNfUEFUSDogdm9pZDtcbn07XG5cblxuZXhwb3J0IGNsYXNzIEludmFsaWRQYXRoRXhjZXB0aW9uIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7XG4gIGNvbnN0cnVjdG9yKHBhdGg6IHN0cmluZykgeyBzdXBlcihgUGF0aCBcIiR7cGF0aH1cIiBpcyBpbnZhbGlkLmApOyB9XG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZVBhdGgocGF0aDogc3RyaW5nKTogU2NoZW1hdGljUGF0aCB7XG4gIGxldCBwID0gcGF0aDtcbiAgaWYgKHBbMF0gIT0gJy8nKSB7XG4gICAgcCA9ICcvJyArIHA7XG4gIH1cbiAgaWYgKHAuZW5kc1dpdGgoJy4uJykpIHtcbiAgICB0aHJvdyBuZXcgSW52YWxpZFBhdGhFeGNlcHRpb24ocGF0aCk7XG4gIH1cblxuICBsZXQgb2xkUDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIHdoaWxlIChvbGRQICE9PSBwKSB7XG4gICAgb2xkUCA9IHA7XG4gICAgcCA9IHBcbiAgICAgIC5yZXBsYWNlKC9cXC9bXlxcL10rXFwvXFwuXFwuXFwvL2csICcvJylcbiAgICAgIC5yZXBsYWNlKC9cXC9bXlxcL10rXFwvXFwuXFwuJC9nLCAnLycpXG4gICAgICAucmVwbGFjZSgvXFwvXFwuPyQvZywgJy8nKVxuICAgICAgLnJlcGxhY2UoL1xcL1xcLj9cXC8vZywgJy8nKTtcbiAgfVxuXG4gIGlmIChwLnN0YXJ0c1dpdGgoJy8uLi8nKSB8fCAocC5lbmRzV2l0aCgnLycpICYmIHAgIT09ICcvJykpIHtcbiAgICB0aHJvdyBuZXcgSW52YWxpZFBhdGhFeGNlcHRpb24ocGF0aCk7XG4gIH1cblxuICByZXR1cm4gKHAgYXMgU2NoZW1hdGljUGF0aCk7XG59XG4iXX0=